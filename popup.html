<html>
<head>
<script>

	// send message to my-library.html to add the given link to local storage.
	function addFileToLibrary(ref)
	{
		var mp3div = ref.parentNode;
		var link = mp3div.childNodes[0];
		chrome.extension.sendRequest({addmp3:link.href, linktext:link.innerHTML});
	}

	function updateList()
	{
		var target = document.getElementById("links_found");
		var bgLinks = chrome.extension.getBackgroundPage().links;
		
		var currentPageLinks = bgLinks.length;
		//alert(currentPageLinks);
		
		var insert = "";
		for(i = 0; i < bgLinks.length; i++)
		{
			insert+="<div class=\"mp3linknode\"><a onClick=\"play(this.href);\" href=\""+bgLinks[i].href+"\">"+bgLinks[i].text+"</a><input type=\"button\" value=\"Add To Library\" onClick=\"addFileToLibrary(this);\"></div>";
		}
		
		target.innerHTML = insert;
	}
	
	function play(href)
	{
		console.log("PLAY: "+href);
		var playertarget = document.getElementById("player_area");
		playertarget.innerHTML = genPlayerLink(href);
	}
	
	function genPlayerLink(href)
	{
		return "<audio autoplay controls src=\""+href+"\"></audio>";
	}

</script>
</head>
<body onLoad="updateList()" style="width:300px;";>
    <p>MP3-Links found:</p>
	<p id="player_area"></p>
    <p id="links_found"></p>
<h2>My Library</h2>
<p><a href="my-library.html" target="_blank">View My Library</a></p>
  </body>
</html>
