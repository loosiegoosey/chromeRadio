<script>

	var links = null;
	chromeRadioStoragePrefix = "mp3_url:";

	// this listener gets content_script results when user changed active tab
	chrome.tabs.onSelectionChanged.addListener(function(tabId, info) {

		updateLinks(tabId);

	});
	
	
	// simply add new mp3 without a message
	// this is called in popup.html
	function addToLibrary(href,text)
	{
		setItem(chromeRadioStoragePrefix+href, text);
	}
	
	// check for popup.html if given mp3 already is in local storage.
	function mp3IsInLibrary(href)
	{
		console.log("checking: "+href);
		if(getItem(chromeRadioStoragePrefix+href) != null)
		{
			return true;
		}
		else
		{
			return false;
		}
	}
	
	function setItem(key, value) {
	  try {
		window.localStorage.removeItem(key);
		window.localStorage.setItem(key, value);
	  }catch(e) {
	  }
	}

	//Gets the item from local storage with the specified key
	function getItem(key) {
	  var value;
	  try {
		value = window.localStorage.getItem(key);
	  }catch(e) {
		//value = "null";
		return null;
	  }
	  return value;
	}
	
	function updateLinks(tabId)
	{
		chrome.tabs.sendRequest(tabId,{update:"true"});
	}
	
	// LISTENER THAT UPDATES THE BADGE WHEN A LINK COUNT IS BEING SENT FROM CONTENT-SCRIPT.

	chrome.extension.onRequest.addListener(
	function(request, sender, sendResponse) {
		
		//alert(links);
		if (request == null)
		{
			chrome.browserAction.setBadgeText({text:"0"});
			//chrome.extension.getURL("popup.html").updateList();		
			chrome.extension.getURL("popup.html").updateList();	
		}
		else
		{
			links = request;
			chrome.browserAction.setBadgeText({text:links.length.toString()});
			chrome.extension.getURL("popup.html").updateList();		
		}

		//document.getElementById("links_found").innerHTML = request:numlinks;
		sendResponse({}); 
	});
</script>